<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sboot.moabayo.dao.MyPageMapper">

    <!-- 사용자 등록 -->

    <select id="selectSumBalance" parameterType="int" resultType="int">
SELECT NVL(SUM(ua.balance), 0) AS asset
FROM user_account ua
WHERE ua.user_id = :#{userId};
    </select>

<select id="selectAccountCount" parameterType="int" resultType="int">
SELECT COUNT(*) AS account_count
FROM user_account
WHERE user_id = #{userId};
</select>

<select id="selectCardCount" parameterType="int" resultType="int">
SELECT COUNT(*) AS card_count
FROM user_card
WHERE user_id = #{userId};
</select>

  <resultMap id="ProfileMap" type="com.sboot.moabayo.vo.UserVO">
    <result property="name"  column="name"/>
    <result property="phone" column="phone"/>
    <result property="email" column="email"/>
    <result property="addr"  column="address"/>
  </resultMap>

  <select id="selectProfile" parameterType="long" resultMap="UserVO">
    SELECT name, phone, email, address
      FROM users
     WHERE user_id = #{userId}
  </select>

  <update id="updateProfile">
    UPDATE users
       SET name   = #{p.name},
           phone  = #{p.phone},
           email  = #{p.email},
           address= #{p.addr}
     WHERE user_id = #{userId}
  </update>

  <update id="updatePassword">
    UPDATE users
       SET password = #{encPw}
     WHERE user_id = #{userId}
  </update>

</mapper>
