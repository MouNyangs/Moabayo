	<!DOCTYPE html>
	<html lang="ko">
	<head>
	<meta charset="UTF-8">
	<title>로그인 - 모으냥</title>
	<link rel="icon" href="images/cat.ico" type="image/x-icon" />
	<link rel="stylesheet" href="../css/login.css" />
	<link rel="icon" href="images/cat.ico" type="image/x-icon" />
	<link rel="stylesheet" href="css/footer.css" />
	<!-- ✅ 외부 JS 파일 연결 -->
	<script defer src="js/common.js"></script>
	</head>
	<body>
	
		<div class="container">
			<a href="mainpage"><img class="cat-image" src="../images/cat.png" alt="고양이 이미지"></a>
			<h1>어서오세요, 모으냥~</h1>
	
			<div class="login-box">
				<form id="loginForm">
					<label for="username">아이디</label> <input type="text" id="username" name="username" required> <label for="password">비밀번호</label> <input type="password" id="password" name="password" required>
	
					<button type="submit">로그인</button>
				</form>
	
				<div class="links">
					<a href="registerpage">회원가입</a> | <a href="find-id">아이디 찾기</a> | <a href="find-password">비밀번호 찾기</a>
				</div>
			</div>
		</div>

	</div>
	<!-- Footer 삽입 -->
	<div id="footer"></div>
</body>

<script>
document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault(); // form 기본 제출 방지

    const id = document.getElementById("username").value;
    const pw = document.getElementById("password").value;

    try {
        const response = await fetch("/user/validate", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ id, pw })
        });

        if (response.ok) {
            // JSON 응답 파싱
            const user = await response.json();

            // 헤더에서 토큰 추출 (Authorization: Bearer xxx)
            const token = response.headers.get("Authorization");

            if (!token) {
                alert("⚠️ 로그인 성공했지만 토큰이 없습니다.");
                return;
            }

            // localStorage 저장
            localStorage.setItem("token", token);
            localStorage.setItem("userId", user.id);
            localStorage.setItem("userName", user.name || ""); // name이 없을 수도 있으니 기본값 처리
            localStorage.setItem("role", user.role || "");

            alert("✅ 로그인 성공! 환영합니다 " + (user.name || user.id) + "님");
            alert("토큰" +token);
            location.href = "/mainpage"; // 로그인 성공 후 이동

        } else {
            const errorText = await response.text();
            alert("❌ 로그인 실패: " + errorText);
        }
    } catch (err) {
        console.error("🚨 로그인 요청 실패:", err);
        alert("⚠️ 서버에 연결할 수 없습니다.");
    }
});
</script>

</html>

