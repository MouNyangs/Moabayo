	<!DOCTYPE html>
	<html lang="ko">
	<head>
	<meta charset="UTF-8">
	<title>ë¡œê·¸ì¸ - ëª¨ìœ¼ëƒ¥</title>
	<link rel="icon" href="images/cat.ico" type="image/x-icon" />
	<link rel="stylesheet" href="../css/login.css" />
	<link rel="icon" href="images/cat.ico" type="image/x-icon" />
	<link rel="stylesheet" href="css/footer.css" />
	<!-- âœ… ì™¸ë¶€ JS íŒŒì¼ ì—°ê²° -->
	<script defer src="js/common.js"></script>
	</head>
	<body>
	
		<div class="container">
			<a href="mainpage"><img class="cat-image" src="../images/cat.png" alt="ê³ ì–‘ì´ ì´ë¯¸ì§€"></a>
			<h1>ì–´ì„œì˜¤ì„¸ìš”, ëª¨ìœ¼ëƒ¥~</h1>
	
			<div class="login-box">
				<form id="loginForm">
					<label for="username">ì•„ì´ë””</label> <input type="text" id="username" name="username" required> <label for="password">ë¹„ë°€ë²ˆí˜¸</label> <input type="password" id="password" name="password" required>
	
					<button type="submit">ë¡œê·¸ì¸</button>
				</form>
	
				<div class="links">
					<a href="registerpage">íšŒì›ê°€ì…</a> | <a href="find-id">ì•„ì´ë”” ì°¾ê¸°</a> | <a href="find-password">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
				</div>
			</div>
		</div>

	</div>
	<!-- Footer ì‚½ì… -->
	<div id="footer"></div>
</body>

<script>
document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault(); // form ê¸°ë³¸ ì œì¶œ ë°©ì§€

    const id = document.getElementById("username").value;
    const pw = document.getElementById("password").value;

    try {
        const response = await fetch("/user/validate", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ id, pw })
        });

        if (response.ok) {
            // JSON ì‘ë‹µ íŒŒì‹±
            const user = await response.json();

            // í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ (Authorization: Bearer xxx)
            const token = response.headers.get("Authorization");

            if (!token) {
                alert("âš ï¸ ë¡œê·¸ì¸ ì„±ê³µí–ˆì§€ë§Œ í† í°ì´ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // localStorage ì €ì¥
            localStorage.setItem("token", token);
            localStorage.setItem("userId", user.id);
            localStorage.setItem("userName", user.name || ""); // nameì´ ì—†ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ê¸°ë³¸ê°’ ì²˜ë¦¬
            localStorage.setItem("role", user.role || "");

            alert("âœ… ë¡œê·¸ì¸ ì„±ê³µ! í™˜ì˜í•©ë‹ˆë‹¤ " + (user.name || user.id) + "ë‹˜");
            alert("í† í°" +token);
            location.href = "/mainpage"; // ë¡œê·¸ì¸ ì„±ê³µ í›„ ì´ë™

        } else {
            const errorText = await response.text();
            alert("âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + errorText);
        }
    } catch (err) {
        console.error("ğŸš¨ ë¡œê·¸ì¸ ìš”ì²­ ì‹¤íŒ¨:", err);
        alert("âš ï¸ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
});
</script>

</html>

