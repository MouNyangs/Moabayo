<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sboot.moabayo.dao.BankMapper">
	<!-- ìœ ì € ì¡°íšŒ -->
	<select id="findUserByLoginId" parameterType="String"
		resultType="com.sboot.moabayo.vo.UserVO">
		SELECT
		user_id AS userId,
		create_date AS createDate,
		account_num AS accountNum,
		address,
		address_detail AS addressDetail,
		zip_code AS zipCode,
		email,
		name,
		login_id AS loginId,
		password,
		phone,
		refresh_token AS refreshToken,
		simple_password AS simplePassword,
		is_admin AS isAdmin
		FROM users
		WHERE login_Id = #{loginId}
	</select>

  <!-- ê³µí†µ SELECT ì»¬ëŸ¼ -->
  <sql id="AccountSelectColumns">
    ua.user_account_id AS ID,

    /* ì•„ì´ì½˜ì€ type ê¸°ë°˜ ë§¤í•‘ */
    CASE UPPER(bp.type)
      WHEN 'DEPOSIT' THEN 'ğŸ’³'
      WHEN 'SAVINGS' THEN 'ğŸ¦'
      WHEN 'LOAN'    THEN 'ğŸ“„'
      ELSE 'ğŸ’°'
    END AS ICON,

    NVL(ua.account_name, 'ë‚´ í†µì¥') AS NAME,
    ua.account_number AS ACCOUNT_NO,
    bp.name AS PRODUCT,
    bp.type AS TYPE,

    /* ì”ì•¡: ì…ê¸ˆê³„ì—´ +, ì¶œê¸ˆê³„ì—´ - */
    NVL(ua.balance, 0) AS BALANCE,

    /* ê°œì„¤ì¼: ì²« ê±°ë˜ì¼ì (ì—†ìœ¼ë©´ NULL) */
    ua.create_date AS OPENED_AT
  </sql>

	<!-- ì‚¬ìš©ì ê³„ì¢Œ (ë‚´ì—­ ì œì™¸) -->
	<resultMap id="AccountOnlyMap"
		type="com.sboot.moabayo.vo.AccountVO">
		<id column="ID" property="id" />
		<result column="ICON" property="icon" />
		<result column="NAME" property="name" />
		<result column="ACCOUNT_NO" property="number" />
		<result column="PRODUCT" property="product" />
		<result column="TYPE" property="type" />
		<result column="BALANCE" property="balance" />
		<result column="OPENED_AT" property="openedAt" />
	</resultMap>

	<!-- ë¡œê·¸ì¸ ìœ ì €ì˜ 'ëƒ¥ì½”ì¸ ì…ì¶œê¸ˆí†µì¥'(account_id=100) 1ê±´ ì¡°íšŒ -->
	<select id="findNyangcoinAccountByUserId"
		resultMap="AccountOnlyMap" parameterType="long">
		SELECT
		<include refid="AccountSelectColumns" />
		FROM user_account ua
		JOIN bank_product bp ON bp.account_id = ua.account_id
		WHERE ua.user_id = #{userId}
		AND ua.account_id = 100
		FETCH FIRST 1 ROWS ONLY
	</select>

</mapper>
