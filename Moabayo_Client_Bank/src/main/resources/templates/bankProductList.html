<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì€í–‰ ì˜ˆì ê¸ˆÂ·ëŒ€ì¶œ â€” ì¸ë±ìŠ¤</title>
  <!-- Bootstrap 5.3 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="icon" href="http://localhost:8810/images/cat.ico" type="image/x-icon" />
  <style>
    :root{
      --brand-bg:#fff8e6; /* ë² ì´ì§€/ë…¸ë‘ í†¤ */
      --brand-accent:#f1c40f;
      --brand-dark:#6b5b38;
    }
    body{background:#faf7f1}
    .hero{background:linear-gradient(180deg,var(--brand-bg),#ffffff);}
    .chip{border:1px solid #eadfb3;border-radius:999px;padding:.25rem .6rem;background:#fff}
    .rating{font-weight:700;color:#0d6efd}
    .rate-badge{background:#fff3cd;color:#8c6d1f;border:1px solid #ffe69c}
    .type-badge{background:#e7f1ff;color:#084298;border:1px solid #b6d4fe}
    .loan-badge{background:#fde2e1;color:#842029;border:1px solid #f5c2c7}
    .product-card{transition:transform .15s ease, box-shadow .15s ease}
    .product-card:hover{transform:translateY(-2px);box-shadow:0 0.5rem 1rem rgba(0,0,0,.08)}
    .bank-logo{width:36px;height:36px;border-radius:8px;object-fit:cover;border:1px solid #eee}
    .no-outline:focus{box-shadow:none}
    .sticky-actions{position:sticky;top:0;z-index:5;background:#fff;border-bottom:1px solid #eee}
    /* skeleton */
    .skeleton{background:linear-gradient(90deg,#eee 25%,#f6f6f6 37%,#eee 63%);background-size:400% 100%;animation:skeleton-loading 1.4s ease infinite}
    @keyframes skeleton-loading{0%{background-position:100% 0}100%{background-position:-100% 0}}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="border-bottom bg-white">
    <div class="container d-flex align-items-center justify-content-between py-3 gap-3">
      <div class="d-flex align-items-center gap-2">
        <img src="http://localhost:8810/images/cat.png" alt="ëª¨ìœ¼ëƒ¥ì¦ˆ" width="36" height="36" class="rounded" />
        <strong class="fs-5">ì€í–‰ ì˜ˆÂ·ì ê¸ˆÂ·ëŒ€ì¶œ</strong>
      </div>
      <div class="d-flex align-items-center gap-2">
        <a href="mainpage" class="btn btn-sm btn-outline-secondary">í™ˆ</a>
        <a href="/recommendproducts" class="btn btn-sm btn-primary">ì¶”ì²œ ë°›ê¸°</a>
      </div>
    </div>
  </header>

  <!-- Hero / Filters Row -->
  <section class="hero border-bottom">
    <div class="container py-4">
      <div class="row g-3 align-items-center">
        <div class="col-12 col-lg-4">
          <h1 class="h4 mb-2">ë‚´ ì†Œë¹„ìŠµê´€ì— ë§ëŠ” ê¸ˆìœµìƒí’ˆ ì°¾ê¸°</h1>
          <p class="text-secondary mb-0">ì…ì¶œê¸ˆ Â· ì ê¸ˆ Â· ì˜ˆê¸ˆ Â· ëŒ€ì¶œì„ í•œ ê³³ì—ì„œ ë¹„êµí•˜ì„¸ìš”.</p>
        </div>
        <div class="col-12 col-lg-8">
          <div class="d-flex flex-wrap gap-2">
            <div class="input-group flex-grow-1" role="search">
              <span class="input-group-text bg-white">ğŸ”</span>
              <input id="searchInput" type="search" class="form-control" placeholder="ìƒí’ˆëª…, ì€í–‰, í‚¤ì›Œë“œ(ì˜ˆ: ì²­ë…„, ìë™ì´ì²´)" />
            </div>
            <button class="btn btn-outline-secondary d-lg-none" data-bs-toggle="offcanvas" data-bs-target="#filterCanvas">í•„í„°</button>
            <div class="dropdown">
              <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">ì •ë ¬</button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><button class="dropdown-item sort-btn" data-sort="rateDesc">ê¸ˆë¦¬ ë†’ì€ìˆœ</button></li>
                <li><button class="dropdown-item sort-btn" data-sort="rateAsc">ê¸ˆë¦¬ ë‚®ì€ìˆœ</button></li>
                <li><button class="dropdown-item sort-btn" data-sort="popular">ì¸ê¸°ìˆœ</button></li>
                <li><button class="dropdown-item sort-btn" data-sort="new">ì‹ ê·œìˆœ</button></li>
              </ul>
            </div>
            <div class="btn-group" role="group" aria-label="View switch">
              <input type="radio" class="btn-check" name="viewMode" id="viewGrid" autocomplete="off" checked>
              <label class="btn btn-outline-secondary" for="viewGrid">ê·¸ë¦¬ë“œ</label>
              <input type="radio" class="btn-check" name="viewMode" id="viewList" autocomplete="off">
              <label class="btn btn-outline-secondary" for="viewList">ë¦¬ìŠ¤íŠ¸</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Chips -->
      <div class="d-flex flex-wrap gap-2 mt-3">
        <button class="btn btn-sm chip no-outline quick-chip" data-chip="youth"># ì²­ë…„ìš°ëŒ€</button>
        <button class="btn btn-sm chip no-outline quick-chip" data-chip="autotransfer"># ìë™ì´ì²´ ìš°ëŒ€</button>
        <button class="btn btn-sm chip no-outline quick-chip" data-chip="firsttimer"># ì²«ê±°ë˜ ìš°ëŒ€</button>
        <button class="btn btn-sm chip no-outline quick-chip" data-chip="ladymom"># ìœ¡ì•„ë§˜ íŠ¹í™”</button>
        <button class="btn btn-sm chip no-outline quick-chip" data-chip="nightowl"># ì•¼í–‰ì„± ê³ ê°</button>
      </div>
    </div>
  </section>

  <!-- Offcanvas Filters (mobile) -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="filterCanvas" aria-labelledby="filterLabel">
    <div class="offcanvas-header">
      <h5 id="filterLabel">í•„í„°</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <div id="filterBodyMobile"></div>
      <button id="applyFiltersMobile" class="btn btn-primary w-100 mt-3" data-bs-dismiss="offcanvas">ì ìš©í•˜ê¸°</button>
    </div>
  </div>

  <main class="container py-4">
    <div class="row">
      <!-- Sidebar Filters (desktop) -->
      <aside class="col-lg-3 d-none d-lg-block">
        <div class="card mb-3">
          <div class="card-body" id="filterBodyDesktop">
            <!-- JSì—ì„œ ë™ì¼í•œ í•„í„° UI ì£¼ì… -->
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <h6 class="mb-2">í”„ë¡œëª¨ì…˜</h6>
            <div class="small text-secondary">ìë™ì´ì²´ 3ê±´ ë“±ë¡ ì‹œ ìµœê³  ì—° 0.3%p ì¶”ê°€</div>
          </div>
        </div>
      </aside>

      <!-- Products Column -->
      <section class="col-lg-9">
        <div id="resultCount" class="small text-secondary mb-2">ê²€ìƒ‰ ê²°ê³¼ 0ê±´</div>
        <div id="productGrid" class="row g-3"></div>
        <div id="productList" class="list-group d-none"></div>

        <!-- Pagination -->
        <nav class="mt-4">
          <ul class="pagination justify-content-center" id="pagination"></ul>
        </nav>
      </section>
    </div>
  </main>

  <footer class="border-top bg-white mt-5">
    <div class="container py-4 small text-secondary d-flex justify-content-between">
      <span>Â© 2025 ëª¨ì•„ë´ìš” ëª¨ìœ¼ëƒ¥ì¦ˆ</span>
      <a href="#" class="text-secondary">ê³ ê°ì„¼í„°</a>
    </div>
  </footer>

  <!-- Templates injected by JS -->
  <template id="filterTemplate">
    <h6 class="mb-3">ìƒí’ˆ ìœ í˜•</h6>
    <div class="d-flex flex-wrap gap-2 mb-3">
      <div class="form-check">
        <input class="form-check-input filter-type" type="checkbox" value="DEMAND" id="typeDemand" checked>
        <label class="form-check-label" for="typeDemand">ì…ì¶œê¸ˆ</label>
      </div>
      <div class="form-check">
        <input class="form-check-input filter-type" type="checkbox" value="SAVINGS" id="typeSavings" checked>
        <label class="form-check-label" for="typeSavings">ì ê¸ˆ</label>
      </div>
      <div class="form-check">
        <input class="form-check-input filter-type" type="checkbox" value="TIMEDEPOSIT" id="typeTimedeposit" checked>
        <label class="form-check-label" for="typeTimedeposit">ì˜ˆê¸ˆ</label>
      </div>
      <div class="form-check">
        <input class="form-check-input filter-type" type="checkbox" value="LOAN" id="typeLoan" checked>
        <label class="form-check-label" for="typeLoan">ëŒ€ì¶œ</label>
      </div>
    </div>

    <h6 class="mb-2">ê¸ˆë¦¬(%)</h6>
    <div class="row g-2 align-items-center mb-3">
      <div class="col"><input id="rateMin" type="number" step="0.1" min="0" class="form-control" placeholder="ìµœì†Œ"/></div>
      <div class="col-auto">~</div>
      <div class="col"><input id="rateMax" type="number" step="0.1" min="0" class="form-control" placeholder="ìµœëŒ€"/></div>
    </div>

    <h6 class="mb-2">ì€í–‰</h6>
    <select id="bankSelect" class="form-select mb-3">
      <option value="ALL" selected>ì „ì²´</option>
      <option>ëª¨ìœ¼ëƒ¥ì¦ˆì€í–‰</option>
      <option>ëƒ¥ì²­ë…„ì€í–‰</option>
      <option>ëƒ¥ìœ¡ì•„ì€í–‰</option>
      <option>ìº£íŒŒì´ë‚¸ìŠ¤</option>
    </select>

    <h6 class="mb-2">ìš°ëŒ€ ì¡°ê±´</h6>
    <div class="d-flex flex-wrap gap-2 mb-3">
      <div class="form-check">
        <input class="form-check-input pref-check" type="checkbox" value="autotransfer" id="prefAuto">
        <label class="form-check-label" for="prefAuto">ìë™ì´ì²´</label>
      </div>
      <div class="form-check">
        <input class="form-check-input pref-check" type="checkbox" value="youth" id="prefYouth">
        <label class="form-check-label" for="prefYouth">ì²­ë…„</label>
      </div>
      <div class="form-check">
        <input class="form-check-input pref-check" type="checkbox" value="firsttimer" id="prefFirst">
        <label class="form-check-label" for="prefFirst">ì²«ê±°ë˜</label>
      </div>
      <div class="form-check">
        <input class="form-check-input pref-check" type="checkbox" value="ladymom" id="prefMom">
        <label class="form-check-label" for="prefMom">ìœ¡ì•„</label>
      </div>
      <div class="form-check">
        <input class="form-check-input pref-check" type="checkbox" value="nightowl" id="prefNight">
        <label class="form-check-label" for="prefNight">ì•¼ê°„</label>
      </div>
    </div>

    <div class="d-flex gap-2">
      <button id="applyFilters" class="btn btn-primary flex-grow-1">í•„í„° ì ìš©</button>
      <button id="resetFilters" class="btn btn-outline-secondary">ì´ˆê¸°í™”</button>
    </div>
  </template>

  <template id="cardTemplate">
    <div class="col-12 col-md-6 col-xl-4">
      <div class="card product-card h-100">
        <div class="card-body d-flex flex-column gap-2">
          <div class="d-flex align-items-center gap-2">
            <img class="bank-logo" alt="ì€í–‰ ë¡œê³ " />
            <div class="d-flex flex-column">
              <strong class="product-name"></strong>
              <span class="text-secondary small bank-name"></span>
            </div>
            <div class="ms-auto d-flex gap-1 align-items-center">
              <span class="badge type-badge product-type">ìœ í˜•</span>
              <span class="badge rate-badge product-rate">ì—° 0.0%</span>
            </div>
          </div>
          <p class="text-secondary small mb-0 product-desc"></p>
          <div class="d-flex flex-wrap gap-1 product-tags"></div>
          <div class="d-flex align-items-center justify-content-between mt-auto">
            <div class="small">ê¸°ê°„ <span class="product-term">-</span> Â· ìµœëŒ€ <span class="product-max">-</span></div>
            <a class="btn btn-sm btn-outline-primary stretched-link detail-link">ìì„¸íˆ</a>
          </div>
        </div>
      </div>
    </div>
  </template>

  <template id="listItemTemplate">
    <a class="list-group-item list-group-item-action py-3">
      <div class="d-flex w-100 align-items-center gap-3">
        <img class="bank-logo" alt="ì€í–‰ ë¡œê³ " />
        <div class="me-auto">
          <div class="d-flex align-items-center gap-2">
            <strong class="product-name"></strong>
            <span class="badge type-badge product-type">ìœ í˜•</span>
            <span class="badge rate-badge product-rate">ì—° 0.0%</span>
          </div>
          <div class="small text-secondary bank-name"></div>
          <div class="small text-secondary product-desc text-truncate"></div>
          <div class="d-flex flex-wrap gap-1 mt-1 product-tags"></div>
        </div>
        <div class="text-end small">
          <div>ê¸°ê°„ <span class="product-term">-</span></div>
          <div>ìµœëŒ€ <span class="product-max">-</span></div>
        </div>
      </div>
    </a>
  </template>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ---- Mock Data (ì‹¤ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ ë°ì´í„°ë¡œ êµì²´) ----
    const PRODUCTS = [
      { id:1, name:"ëƒ¥ì²­ë…„ ì ê¸ˆ", bank:"ëƒ¥ì²­ë…„ì€í–‰", type:"SAVINGS", rate:4.2, term:"12~36ê°œì›”", max:"ì›” 100ë§Œì›", tags:["youth","autotransfer","firsttimer"], desc:"ì²­ë…„ ë§ì¶¤ ìš°ëŒ€ê¸ˆë¦¬, ìë™ì´ì²´ë¡œ ìµœëŒ€ 0.3%p ì¶”ê°€.", logo:"/images/banks/youth.png", createdAt:"2025-07-01", popular:98 },
      { id:2, name:"ëƒ¥ìœ¡ì•„ ì ê¸ˆ", bank:"ëƒ¥ìœ¡ì•„ì€í–‰", type:"SAVINGS", rate:4.0, term:"12~24ê°œì›”", max:"ì›” 70ë§Œì›", tags:["ladymom","autotransfer"], desc:"ìœ¡ì•„ë§˜ ìƒí™œ ë§ì¶¤ í˜œíƒ(ì¿ í°/ìºì‹œë°±).", logo:"/images/banks/mom.png", createdAt:"2025-07-10", popular:92 },
      { id:3, name:"ìº£í”ŒëŸ¬ìŠ¤ ì˜ˆê¸ˆ", bank:"ìº£íŒŒì´ë‚¸ìŠ¤", type:"TIMEDEPOSIT", rate:3.6, term:"6~24ê°œì›”", max:"ì œí•œì—†ìŒ", tags:["firsttimer"], desc:"ì²« ê±°ë˜ ê³ ê° ìš°ëŒ€ ê¸ˆë¦¬ ì œê³µ.", logo:"/images/banks/catfin.png", createdAt:"2025-06-21", popular:75 },
      { id:4, name:"ëª¨ìœ¼ëƒ¥ì¦ˆ ì…ì¶œê¸ˆ í†µì¥", bank:"ëª¨ìœ¼ëƒ¥ì¦ˆì€í–‰", type:"DEMAND", rate:1.2, term:"ì œí•œì—†ìŒ", max:"ì œí•œì—†ìŒ", tags:["autotransfer","nightowl"], desc:"ìˆ˜ìˆ˜ë£Œ ìš°ëŒ€ ë° ì•¼ê°„ í˜œíƒ ì œê³µ.", logo:"/images/banks/moa.png", createdAt:"2025-08-01", popular:88 },
      { id:5, name:"ëƒ¥ì²­ë…„ ì „ì„¸ìê¸ˆ", bank:"ëƒ¥ì²­ë…„ì€í–‰", type:"LOAN", rate:3.1, term:"ìµœëŒ€ 4ë…„", max:"1ì–µ 5ì²œë§Œì›", tags:["youth"], desc:"ì²­ë…„ ì „ì„¸ìê¸ˆ íŠ¹í™” ëŒ€ì¶œ ìƒí’ˆ.", logo:"/images/banks/youth.png", createdAt:"2025-07-25", popular:84 },
      { id:6, name:"ìƒˆë²½í˜• ì ê¸ˆ", bank:"ëª¨ìœ¼ëƒ¥ì¦ˆì€í–‰", type:"SAVINGS", rate:4.1, term:"6~12ê°œì›”", max:"ì›” 50ë§Œì›", tags:["nightowl","autotransfer"], desc:"ì•¼í–‰ì„± ê³ ê° ìë™ì´ì²´ ìš°ëŒ€.", logo:"/images/banks/moa.png", createdAt:"2025-07-30", popular:71 },
      { id:7, name:"ë¹ ë¥¸ëŒ€ì¶œ", bank:"ìº£íŒŒì´ë‚¸ìŠ¤", type:"LOAN", rate:4.8, term:"ìµœëŒ€ 5ë…„", max:"7ì²œë§Œì›", tags:[], desc:"ê°„í¸ ì‹¬ì‚¬Â·ì‹ ì† ì‹¤í–‰.", logo:"/images/banks/catfin.png", createdAt:"2025-05-30", popular:63 },
      { id:8, name:"ì •ê¸°ì˜ˆê¸ˆ í”ŒëŸ¬ìŠ¤", bank:"ëƒ¥ìœ¡ì•„ì€í–‰", type:"TIMEDEPOSIT", rate:3.9, term:"12ê°œì›”", max:"ì œí•œì—†ìŒ", tags:["autotransfer"], desc:"ì•ˆì •ì ì¸ ê¸ˆë¦¬, ìë™ì´ì²´ ìš°ëŒ€.", logo:"/images/banks/mom.png", createdAt:"2025-06-28", popular:69 },
    ];

    // ---- State ----
    const state = {
      query: "",
      types: new Set(["DEMAND","SAVINGS","TIMEDEPOSIT","LOAN"]),
      rateMin: null,
      rateMax: null,
      bank: "ALL",
      prefs: new Set(),
      sort: "rateDesc",
      view: "grid",
      page: 1,
      perPage: 9,
    };

    // ---- Utils ----
    const typeLabel = (t)=>({DEMAND:"ì…ì¶œê¸ˆ", SAVINGS:"ì ê¸ˆ", TIMEDEPOSIT:"ì˜ˆê¸ˆ", LOAN:"ëŒ€ì¶œ"}[t]||t);

    function buildFilters(container){
      const tpl = document.getElementById('filterTemplate');
      container.innerHTML = tpl.innerHTML;
    }

    function syncFilterValues(){
      // types
      document.querySelectorAll('.filter-type').forEach(chk=>{
        chk.checked = state.types.has(chk.value);
      });
      // rate
      document.getElementById('rateMin').value = state.rateMin ?? '';
      document.getElementById('rateMax').value = state.rateMax ?? '';
      // bank
      document.getElementById('bankSelect').value = state.bank;
      // prefs
      document.querySelectorAll('.pref-check').forEach(chk=>{
        chk.checked = state.prefs.has(chk.value);
      });
    }

    function collectFilterValues(){
      const newTypes = new Set();
      document.querySelectorAll('.filter-type').forEach(chk=>{ if(chk.checked) newTypes.add(chk.value); });
      state.types = newTypes;
      const min = parseFloat(document.getElementById('rateMin').value); state.rateMin = isNaN(min)?null:min;
      const max = parseFloat(document.getElementById('rateMax').value); state.rateMax = isNaN(max)?null:max;
      state.bank = document.getElementById('bankSelect').value;
      const prefs = new Set();
      document.querySelectorAll('.pref-check').forEach(chk=>{ if(chk.checked) prefs.add(chk.value); });
      state.prefs = prefs;
      state.page = 1; // reset page
    }

    function filterProducts(){
      let list = PRODUCTS.filter(p=> state.types.has(p.type));
      if(state.query){
        const q = state.query.toLowerCase();
        list = list.filter(p => (p.name+" "+p.bank+" "+p.desc).toLowerCase().includes(q));
      }
      if(state.bank !== 'ALL') list = list.filter(p=>p.bank === state.bank);
      if(state.rateMin!=null) list = list.filter(p=>p.rate >= state.rateMin);
      if(state.rateMax!=null) list = list.filter(p=>p.rate <= state.rateMax);
      if(state.prefs.size>0) list = list.filter(p=> [...state.prefs].every(t=>p.tags.includes(t)) );

      switch(state.sort){
        case 'rateDesc': list.sort((a,b)=>b.rate-a.rate); break;
        case 'rateAsc': list.sort((a,b)=>a.rate-b.rate); break;
        case 'popular': list.sort((a,b)=>b.popular-a.popular); break;
        case 'new': list.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt)); break;
      }
      return list;
    }

    function paginate(list){
      const start = (state.page-1)*state.perPage;
      return list.slice(start, start+state.perPage);
    }

    function render(){
      const list = filterProducts();
      document.getElementById('resultCount').textContent = `ê²€ìƒ‰ ê²°ê³¼ ${list.length}ê±´`;

      const paged = paginate(list);
      renderGrid(paged);
      renderList(paged);
      renderPagination(list.length);
    }

    function badgeForType(t){
      const span = document.createElement('span');
      span.className = `badge ${t==='LOAN'?'loan-badge':'type-badge'} product-type`;
      span.textContent = typeLabel(t);
      return span;
    }

    function renderGrid(items){
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';
      const tpl = document.getElementById('cardTemplate');
      items.forEach(p=>{
        const node = tpl.content.cloneNode(true);
        node.querySelector('.product-name').textContent = p.name;
        node.querySelector('.bank-name').textContent = p.bank;
        node.querySelector('.product-type').replaceWith(badgeForType(p.type));
        node.querySelector('.product-rate').textContent = `ì—° ${p.rate.toFixed(1)}%`;
        node.querySelector('.product-desc').textContent = p.desc;
        node.querySelector('.product-term').textContent = p.term;
        node.querySelector('.product-max').textContent = p.max;
        node.querySelector('.bank-logo').src = p.logo;
        const tagsWrap = node.querySelector('.product-tags');
        p.tags.forEach(t=>{
          const s = document.createElement('span');
          s.className = 'badge bg-light text-secondary border';
          s.textContent = `# ${t}`;
          tagsWrap.appendChild(s);
        })
        const detail = node.querySelector('.detail-link');
        detail.href = `/bank/products/${p.id}`; // ë¼ìš°íŒ… ê·œì¹™ì— ë§ê²Œ ìˆ˜ì •
        grid.appendChild(node);
      });
      document.getElementById('productGrid').classList.toggle('d-none', state.view!=="grid");
    }

    function renderList(items){
      const listEl = document.getElementById('productList');
      listEl.innerHTML = '';
      const tpl = document.getElementById('listItemTemplate');
      items.forEach(p=>{
        const node = tpl.content.cloneNode(true);
        node.querySelector('.product-name').textContent = p.name;
        node.querySelector('.bank-name').textContent = p.bank;
        node.querySelector('.product-type').replaceWith(badgeForType(p.type));
        node.querySelector('.product-rate').textContent = `ì—° ${p.rate.toFixed(1)}%`;
        node.querySelector('.product-desc').textContent = p.desc;
        node.querySelector('.product-term').textContent = p.term;
        node.querySelector('.product-max').textContent = p.max;
        node.querySelector('.bank-logo').src = p.logo;
        const tagsWrap = node.querySelector('.product-tags');
        p.tags.forEach(t=>{
          const s = document.createElement('span');
          s.className = 'badge bg-light text-secondary border';
          s.textContent = `# ${t}`;
          tagsWrap.appendChild(s);
        })
        const anchor = node.querySelector('a');
        anchor.href = `/bank/products/${p.id}`;
        listEl.appendChild(node);
      });
      listEl.classList.toggle('d-none', state.view!=="list");
    }

    function renderPagination(total){
      const ul = document.getElementById('pagination');
      ul.innerHTML = '';
      const pages = Math.max(1, Math.ceil(total/state.perPage));
      const add = (label, page, disabled=false, active=false)=>{
        const li = document.createElement('li');
        li.className = `page-item ${disabled?'disabled':''} ${active?'active':''}`;
        const a = document.createElement('a');
        a.className = 'page-link'; a.href = '#'; a.textContent = label;
        a.addEventListener('click', (e)=>{ e.preventDefault(); if(!disabled){ state.page = page; render(); }});
        li.appendChild(a); ul.appendChild(li);
      }
      add('Â«', Math.max(1, state.page-1), state.page===1);
      for(let i=1;i<=pages;i++) add(i, i, false, i===state.page);
      add('Â»', Math.min(pages, state.page+1), state.page===pages);
    }

    function mountFilters(){
      const desktop = document.getElementById('filterBodyDesktop');
      const mobile = document.getElementById('filterBodyMobile');
      buildFilters(desktop);
      buildFilters(mobile);
      syncFilterValues();

      document.getElementById('applyFilters').addEventListener('click', ()=>{ collectFilterValues(); render(); });
      document.getElementById('resetFilters').addEventListener('click', ()=>{
        state.types = new Set(["DEMAND","SAVINGS","TIMEDEPOSIT","LOAN"]);
        state.rateMin = state.rateMax = null; state.bank='ALL'; state.prefs = new Set(); state.page = 1;
        syncFilterValues(); render();
      });
      document.getElementById('applyFiltersMobile').addEventListener('click', ()=>{ collectFilterValues(); render(); });
    }

    function mountTopbar(){
      document.getElementById('searchInput').addEventListener('input', (e)=>{ state.query = e.target.value.trim(); state.page=1; render(); });
      document.querySelectorAll('.sort-btn').forEach(btn=> btn.addEventListener('click', ()=>{ state.sort = btn.dataset.sort; render(); }));
      document.getElementById('viewGrid').addEventListener('change', ()=>{ state.view='grid'; render(); });
      document.getElementById('viewList').addEventListener('change', ()=>{ state.view='list'; render(); });
      document.querySelectorAll('.quick-chip').forEach(ch=> ch.addEventListener('click', ()=>{
        const key = ch.dataset.chip;
        if(state.prefs.has(key)) state.prefs.delete(key); else state.prefs.add(key);
        // ì‹œê°ì  í† ê¸€
        ch.classList.toggle('btn-primary'); ch.classList.toggle('chip'); ch.classList.toggle('text-white');
        state.page=1; render();
      }));
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', ()=>{
      mountFilters();
      mountTopbar();
      render();
    });
  </script>
</body>
</html>