<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>모으냥즈 | 계좌 조회</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="icon" href="/images/cat.ico" type="image/x-icon" />
  <style>
    :root{
      --bg: #FFF8E7;           /* cat cream */
      --card: #F4E6C4;         /* cat beige */
      --ink: #2b2b2b;          /* text */
      --accent: #F2C14E;       /* amber */
      --muted: #8b6f47;        /* brown */
      --table-head: #f1e4c5;
    }
    body.dark{
      --bg: #141414;
      --card: #1f1f1f;
      --ink: #e9e9e9;
      --accent: #F2C14E;
      --muted: #b7a27f;
      --table-head: #2a2a2a;
    }
    body{ background: var(--bg); color: var(--ink); }
    .ny-card{ background: var(--card); border:0; border-radius: 1rem; }
    .shadow-soft{ box-shadow: 0 10px 25px rgba(0,0,0,.06); }
    .brand{ font-weight: 800; letter-spacing:.3px; }
    .ny-badge{ background: var(--accent); color:#2b2b2b; }
    .table thead th{ background: var(--table-head); }
    .search-chip{ background: rgba(0,0,0,.06); border-radius: 999px; padding: .25rem .6rem; font-size: .85rem; }
    body.dark .search-chip{ background: #2c2c2c; }
    .form-control, .form-select{ background: #fff; }
    body.dark .form-control, body.dark .form-select{ background: #121212; color: var(--ink); border-color:#2f2f2f; }
  </style>
</head>
<body th:classappend="${darkMode} ? 'dark' : ''">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg" style="background:var(--card)">
    <div class="container">
      <a class="navbar-brand brand" href="/bank/index">🐾 모으냥즈 뱅크</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto align-items-center gap-2">
          <li class="nav-item"><a class="nav-link" href="/bank/account/list">계좌</a></li>
          <li class="nav-item"><a class="nav-link" href="/bank/product/list">상품</a></li>
          <li class="nav-item"><a class="nav-link" href="/bank/recommend">추천</a></li>
          <li class="nav-item"><button id="darkToggle" class="btn btn-sm btn-outline-dark">다크모드</button></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <!-- 헤더 -->
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div>
        <div class="small text-muted">내 계좌 조회</div>
        <h2 class="m-0" th:text="${loginId} + ' 님의 계좌'">guest 님의 계좌</h2>
      </div>
      <span class="badge ny-badge rounded-pill px-3 py-2">ACCOUNT LIST</span>
    </div>

    <!-- 요약 카드 -->
    <section class="row g-3 mb-4">
      <div class="col-12 col-md-4">
        <div class="card ny-card shadow-soft p-3 h-100">
          <div class="d-flex justify-content-between align-items-start">
            <h6 class="m-0">총 보유 잔액</h6>
            <span class="search-chip">KRW</span>
          </div>
          <div class="display-6 mt-2" th:text="${totalBalance != null ? #numbers.formatInteger(totalBalance, 3, 'COMMA') + ' 원' : '0 원'}">0 원</div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card ny-card shadow-soft p-3 h-100">
          <h6 class="m-0">계좌 수</h6>
          <div class="display-6 mt-2" th:text="${accounts != null ? #lists.size(accounts) : 0}">0</div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card ny-card shadow-soft p-3 h-100">
          <h6 class="m-0">최근 개설일</h6>
          <div class="h3 mt-2" th:text="${latestOpenedAt != null ? #dates.format(latestOpenedAt, 'yyyy-MM-dd') : '-'}">-</div>
        </div>
      </div>
    </section>

    <!-- 필터/검색 바 -->
    <section class="card ny-card shadow-soft mb-4">
      <div class="card-body">
        <form class="row g-2 align-items-end" method="get" th:action="@{/bank/account/list}">
          <div class="col-12 col-md-5">
            <label class="form-label">검색 (계좌명/번호)</label>
            <input type="text" class="form-control" name="q" placeholder="예) 생활비통장, 123-456-7890" th:value="${param.q}" />
          </div>
          <div class="col-6 col-md-3">
            <label class="form-label">유형</label>
            <select class="form-select" name="type">
              <option value="" th:selected="${param.type == null or param.type == ''}">전체</option>
              <option th:value="DEPOSIT" th:selected="${param.type == 'DEPOSIT'}">입출금</option>
              <option th:value="SAVINGS" th:selected="${param.type == 'SAVINGS'}">적금</option>
              <option th:value="LOAN" th:selected="${param.type == 'LOAN'}">대출</option>
            </select>
          </div>
          <div class="col-6 col-md-2">
            <label class="form-label">정렬</label>
            <select class="form-select" name="sort">
              <option th:value="RECENT" th:selected="${param.sort == null or param.sort == 'RECENT'}">최근순</option>
              <option th:value="BALANCE_DESC" th:selected="${param.sort == 'BALANCE_DESC'}">잔액↓</option>
              <option th:value="BALANCE_ASC" th:selected="${param.sort == 'BALANCE_ASC'}">잔액↑</option>
            </select>
          </div>
          <div class="col-12 col-md-2 d-grid">
            <button class="btn btn-dark" type="submit">검색</button>
          </div>
        </form>
      </div>
    </section>

    <!-- 계좌 목록 테이블 -->
    <section class="card shadow-soft">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="m-0">보유 계좌</h5>
          <div class="d-flex gap-2">
            <a class="btn btn-sm btn-outline-dark" href="/bank/account/new">새 계좌 개설</a>
            <a class="btn btn-sm btn-outline-dark" href="/bank/transfer">송금</a>
          </div>
        </div>

        <!-- 빈 상태 -->
        <div th:if="${#lists.isEmpty(accounts)}" class="text-center text-muted py-5">
          표시할 계좌가 없습니다. <a href="/bank/account/new">지금 개설하기</a>
        </div>

        <!-- 테이블 -->
        <div th:if="${!#lists.isEmpty(accounts)}" class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>계좌명</th>
                <th>계좌번호</th>
                <th>상품</th>
                <th>유형</th>
                <th class="text-end">잔액(원)</th>
                <th>개설일</th>
                <th class="text-end">동작</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="a : ${accounts}">
                <td th:text="${a.accountName}">생활비통장</td>
                <td th:text="${a.accountNumber}">123-456-7890</td>
                <td th:text="${a.productName}">냥청년 적금</td>
                <td>
                  <span class="badge rounded-pill"
                        th:text="${a.type}"
                        th:classappend=" ${a.type}=='DEPOSIT' ? 'text-bg-success' : (${a.type}=='SAVINGS' ? 'text-bg-primary' : (${a.type}=='LOAN' ? 'text-bg-warning' : 'text-bg-secondary')) ">
                    DEPOSIT
                  </span>
                </td>
                <td class="text-end" th:text="${#numbers.formatInteger(a.balance, 3, 'COMMA')}">0</td>
                <td th:text="${a.createdAt != null ? #dates.format(a.createdAt, 'yyyy-MM-dd') : '-'}">-</td>
                <td class="text-end">
                  <div class="btn-group">
                    <a class="btn btn-sm btn-outline-dark" th:href="@{'/bank/account/' + ${a.accountId}}">상세</a>
                    <a class="btn btn-sm btn-dark" th:href="@{'/bank/transfer'(from=${a.accountId})}">송금</a>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 페이지네이션 -->
        <nav th:if="${totalPages != null and totalPages > 1}" class="mt-3">
          <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage <= 1} ? 'disabled'">
              <a class="page-link" th:href="@{/bank/account/list(page=${currentPage - 1}, q=${param.q}, type=${param.type}, sort=${param.sort})}">이전</a>
            </li>
            <li class="page-item disabled"><a class="page-link" th:text="${currentPage} + ' / ' + ${totalPages}">1 / 1</a></li>
            <li class="page-item" th:classappend="${currentPage >= totalPages} ? 'disabled'">
              <a class="page-link" th:href="@{/bank/account/list(page=${currentPage + 1}, q=${param.q}, type=${param.type}, sort=${param.sort})}">다음</a>
            </li>
          </ul>
        </nav>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="py-4 mt-5" style="background:var(--card)">
    <div class="container d-flex justify-content-between align-items-center">
      <span class="small">© 2025 MoaNyangs Bank</span>
      <span class="small">고객센터: 1588-0000</span>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 다크모드 토글 (간단 저장)
    const key = 'moa.dark';
    const btn = document.getElementById('darkToggle');
    const body = document.body;
    const saved = localStorage.getItem(key);
    if(saved === '1'){ body.classList.add('dark'); }
    btn?.addEventListener('click', () => {
      body.classList.toggle('dark');
      localStorage.setItem(key, body.classList.contains('dark') ? '1' : '0');
    });
  </script>
</body>
</html>
