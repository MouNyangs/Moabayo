<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ëª¨ìœ¼ëƒ¥ì¦ˆ | ê³„ì¢Œ ì¡°íšŒ</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="icon" href="/images/cat.ico" type="image/x-icon" />
  <style>
    :root{
      --bg: #FFF8E7;           /* cat cream */
      --card: #F4E6C4;         /* cat beige */
      --ink: #2b2b2b;          /* text */
      --accent: #F2C14E;       /* amber */
      --muted: #8b6f47;        /* brown */
      --table-head: #f1e4c5;
    }
    body.dark{
      --bg: #141414;
      --card: #1f1f1f;
      --ink: #e9e9e9;
      --accent: #F2C14E;
      --muted: #b7a27f;
      --table-head: #2a2a2a;
    }
    body{ background: var(--bg); color: var(--ink); }
    .ny-card{ background: var(--card); border:0; border-radius: 1rem; }
    .shadow-soft{ box-shadow: 0 10px 25px rgba(0,0,0,.06); }
    .brand{ font-weight: 800; letter-spacing:.3px; }
    .ny-badge{ background: var(--accent); color:#2b2b2b; }
    .table thead th{ background: var(--table-head); }
    .search-chip{ background: rgba(0,0,0,.06); border-radius: 999px; padding: .25rem .6rem; font-size: .85rem; }
    body.dark .search-chip{ background: #2c2c2c; }
    .form-control, .form-select{ background: #fff; }
    body.dark .form-control, body.dark .form-select{ background: #121212; color: var(--ink); border-color:#2f2f2f; }
  </style>
</head>
<body th:classappend="${darkMode} ? 'dark' : ''">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg" style="background:var(--card)">
    <div class="container">
      <a class="navbar-brand brand" href="/bank/index">ğŸ¾ ëª¨ìœ¼ëƒ¥ì¦ˆ ë±…í¬</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto align-items-center gap-2">
          <li class="nav-item"><a class="nav-link" href="/bank/account/list">ê³„ì¢Œ</a></li>
          <li class="nav-item"><a class="nav-link" href="/bank/product/list">ìƒí’ˆ</a></li>
          <li class="nav-item"><a class="nav-link" href="/bank/recommend">ì¶”ì²œ</a></li>
          <li class="nav-item"><button id="darkToggle" class="btn btn-sm btn-outline-dark">ë‹¤í¬ëª¨ë“œ</button></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <!-- í—¤ë” -->
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div>
        <div class="small text-muted">ë‚´ ê³„ì¢Œ ì¡°íšŒ</div>
        <h2 class="m-0" th:text="${loginId} + ' ë‹˜ì˜ ê³„ì¢Œ'">guest ë‹˜ì˜ ê³„ì¢Œ</h2>
      </div>
      <span class="badge ny-badge rounded-pill px-3 py-2">ACCOUNT LIST</span>
    </div>

    <!-- ìš”ì•½ ì¹´ë“œ -->
    <section class="row g-3 mb-4">
      <div class="col-12 col-md-4">
        <div class="card ny-card shadow-soft p-3 h-100">
          <div class="d-flex justify-content-between align-items-start">
            <h6 class="m-0">ì´ ë³´ìœ  ì”ì•¡</h6>
            <span class="search-chip">KRW</span>
          </div>
          <div class="display-6 mt-2" th:text="${totalBalance != null ? #numbers.formatInteger(totalBalance, 3, 'COMMA') + ' ì›' : '0 ì›'}">0 ì›</div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card ny-card shadow-soft p-3 h-100">
          <h6 class="m-0">ê³„ì¢Œ ìˆ˜</h6>
          <div class="display-6 mt-2" th:text="${accounts != null ? #lists.size(accounts) : 0}">0</div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="card ny-card shadow-soft p-3 h-100">
          <h6 class="m-0">ìµœê·¼ ê°œì„¤ì¼</h6>
          <div class="h3 mt-2" th:text="${latestOpenedAt != null ? #dates.format(latestOpenedAt, 'yyyy-MM-dd') : '-'}">-</div>
        </div>
      </div>
    </section>

    <!-- í•„í„°/ê²€ìƒ‰ ë°” -->
    <section class="card ny-card shadow-soft mb-4">
      <div class="card-body">
        <form class="row g-2 align-items-end" method="get" th:action="@{/bank/account/list}">
          <div class="col-12 col-md-5">
            <label class="form-label">ê²€ìƒ‰ (ê³„ì¢Œëª…/ë²ˆí˜¸)</label>
            <input type="text" class="form-control" name="q" placeholder="ì˜ˆ) ìƒí™œë¹„í†µì¥, 123-456-7890" th:value="${param.q}" />
          </div>
          <div class="col-6 col-md-3">
            <label class="form-label">ìœ í˜•</label>
            <select class="form-select" name="type">
              <option value="" th:selected="${param.type == null or param.type == ''}">ì „ì²´</option>
              <option th:value="DEPOSIT" th:selected="${param.type == 'DEPOSIT'}">ì…ì¶œê¸ˆ</option>
              <option th:value="SAVINGS" th:selected="${param.type == 'SAVINGS'}">ì ê¸ˆ</option>
              <option th:value="LOAN" th:selected="${param.type == 'LOAN'}">ëŒ€ì¶œ</option>
            </select>
          </div>
          <div class="col-6 col-md-2">
            <label class="form-label">ì •ë ¬</label>
            <select class="form-select" name="sort">
              <option th:value="RECENT" th:selected="${param.sort == null or param.sort == 'RECENT'}">ìµœê·¼ìˆœ</option>
              <option th:value="BALANCE_DESC" th:selected="${param.sort == 'BALANCE_DESC'}">ì”ì•¡â†“</option>
              <option th:value="BALANCE_ASC" th:selected="${param.sort == 'BALANCE_ASC'}">ì”ì•¡â†‘</option>
            </select>
          </div>
          <div class="col-12 col-md-2 d-grid">
            <button class="btn btn-dark" type="submit">ê²€ìƒ‰</button>
          </div>
        </form>
      </div>
    </section>

    <!-- ê³„ì¢Œ ëª©ë¡ í…Œì´ë¸” -->
    <section class="card shadow-soft">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="m-0">ë³´ìœ  ê³„ì¢Œ</h5>
          <div class="d-flex gap-2">
            <a class="btn btn-sm btn-outline-dark" href="/bank/account/new">ìƒˆ ê³„ì¢Œ ê°œì„¤</a>
            <a class="btn btn-sm btn-outline-dark" href="/bank/transfer">ì†¡ê¸ˆ</a>
          </div>
        </div>

        <!-- ë¹ˆ ìƒíƒœ -->
        <div th:if="${#lists.isEmpty(accounts)}" class="text-center text-muted py-5">
          í‘œì‹œí•  ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤. <a href="/bank/account/new">ì§€ê¸ˆ ê°œì„¤í•˜ê¸°</a>
        </div>

        <!-- í…Œì´ë¸” -->
        <div th:if="${!#lists.isEmpty(accounts)}" class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>ê³„ì¢Œëª…</th>
                <th>ê³„ì¢Œë²ˆí˜¸</th>
                <th>ìƒí’ˆ</th>
                <th>ìœ í˜•</th>
                <th class="text-end">ì”ì•¡(ì›)</th>
                <th>ê°œì„¤ì¼</th>
                <th class="text-end">ë™ì‘</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="a : ${accounts}">
                <td th:text="${a.accountName}">ìƒí™œë¹„í†µì¥</td>
                <td th:text="${a.accountNumber}">123-456-7890</td>
                <td th:text="${a.productName}">ëƒ¥ì²­ë…„ ì ê¸ˆ</td>
                <td>
                  <span class="badge rounded-pill"
                        th:text="${a.type}"
                        th:classappend=" ${a.type}=='DEPOSIT' ? 'text-bg-success' : (${a.type}=='SAVINGS' ? 'text-bg-primary' : (${a.type}=='LOAN' ? 'text-bg-warning' : 'text-bg-secondary')) ">
                    DEPOSIT
                  </span>
                </td>
                <td class="text-end" th:text="${#numbers.formatInteger(a.balance, 3, 'COMMA')}">0</td>
                <td th:text="${a.createdAt != null ? #dates.format(a.createdAt, 'yyyy-MM-dd') : '-'}">-</td>
                <td class="text-end">
                  <div class="btn-group">
                    <a class="btn btn-sm btn-outline-dark" th:href="@{'/bank/account/' + ${a.accountId}}">ìƒì„¸</a>
                    <a class="btn btn-sm btn-dark" th:href="@{'/bank/transfer'(from=${a.accountId})}">ì†¡ê¸ˆ</a>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <nav th:if="${totalPages != null and totalPages > 1}" class="mt-3">
          <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage <= 1} ? 'disabled'">
              <a class="page-link" th:href="@{/bank/account/list(page=${currentPage - 1}, q=${param.q}, type=${param.type}, sort=${param.sort})}">ì´ì „</a>
            </li>
            <li class="page-item disabled"><a class="page-link" th:text="${currentPage} + ' / ' + ${totalPages}">1 / 1</a></li>
            <li class="page-item" th:classappend="${currentPage >= totalPages} ? 'disabled'">
              <a class="page-link" th:href="@{/bank/account/list(page=${currentPage + 1}, q=${param.q}, type=${param.type}, sort=${param.sort})}">ë‹¤ìŒ</a>
            </li>
          </ul>
        </nav>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="py-4 mt-5" style="background:var(--card)">
    <div class="container d-flex justify-content-between align-items-center">
      <span class="small">Â© 2025 MoaNyangs Bank</span>
      <span class="small">ê³ ê°ì„¼í„°: 1588-0000</span>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ë‹¤í¬ëª¨ë“œ í† ê¸€ (ê°„ë‹¨ ì €ì¥)
    const key = 'moa.dark';
    const btn = document.getElementById('darkToggle');
    const body = document.body;
    const saved = localStorage.getItem(key);
    if(saved === '1'){ body.classList.add('dark'); }
    btn?.addEventListener('click', () => {
      body.classList.toggle('dark');
      localStorage.setItem(key, body.classList.contains('dark') ? '1' : '0');
    });
  </script>
</body>
</html>
